{{ $main_style := dict }}
{{ $assets_to_concat := collections.Slice }}
{{ range collections.Slice "_tachyons.css" "_code.css" "_hugo-internal-templates.css" "_social-icons.css" "_styles.css" }}
  {{ with partials.IncludeCached "func/style/GetResource.html" . . }}
    {{ $assets_to_concat = $assets_to_concat | collections.Append . }}
  {{ end }}
{{ end }}

{{- $config := site.Params.ananke.social -}}
{{- $networks := $config.follow.networks -}}
{{- $setups := (collections.Where $config.networks "slug" "in" $networks) }}
{{ with $setups }}
  {{ $socials_rules := collections.Slice }}
  {{ range $service := . }}
    {{ with .color }}
      {{ $rule := fmt.Printf `
        .ananke-socials a.%s:hover {
          color: %s !important;
        }` $service.slug . }}
      {{ $socials_rules = $socials_rules | collections.Append $rule }}
    {{ end }}
  {{ end }}
  {{ with $socials_rules }}
    {{ $socials_rules = collections.Delimit . " " }}
    {{ $socials_css := $socials_rules | resources.FromString "ananke/css/generated_socials.css" }}
    {{ $assets_to_concat = $assets_to_concat | collections.Append $socials_css }}
  {{ end }}
{{ end }}

{{ with site.Params.custom_css }}
  {{ range . }}
    {{ with partials.IncludeCached "func/style/GetResource.html" . . }}
      {{ if compare.Eq .MediaType.SubType "x-scss" "x-sass" "scss" "sass" }}
        {{ if hugo.IsExtended }}
          {{ $assets_to_concat = $assets_to_concat | collections.Append (. | css.Sass) }}
        {{ else }}
          {{ partials.Include "func/warn.html" (fmt.Printf "Processing of stylesheet %s of type %s has been skipped. You need Hugo Extended to process such files." .Name .MediaType.SubType) }}
        {{ end }}
      {{ else }}
        {{ $assets_to_concat = $assets_to_concat | collections.Append . }}
      {{ end }}
    {{ end }}
  {{ end }}
{{ end }}

{{ with $assets_to_concat }}
  {{ $style := . | resources.Concat "ananke/css/main.css" }}
  {{ $options := dict "enableSourceMap" (not hugo.IsProduction) "precision" 6 }}
  {{ $style = $style | css.Sass $options | resources.Minify }}
  {{ if hugo.IsProduction }}
    {{ $style = $style | resources.Fingerprint }}
  {{ end }}
  {{ $main_style = $style }}
{{ end }}

{{ return $main_style }}
