---
title: "服主应知应会"
summary: "如果你要做为一名服务运维自己的Minecraft服务器，这篇文章中的知识需要了解和掌握。"
weight: 20
---

---

## 服务器迁移Paper

- 从Vanilla迁移，因为地图抽离成三个文件夹，分别对应：主世界、下界、末地。这个抽离过程会自动进行
- 从Spigot迁移，不需要做任何操作，只需要替换 jar 文件即可

## 服务器版本升级时需要关注的文件

```
.
├── eula.txt            // eula协议文件，需要同意，否则无法启动
├── plugins             // 服务器安装的插件所在目录，主要关注插件配置文件
├── server-icon.png     // 服务器自定义图标
├── server.properties   // 服务器配置属性，离线/在线模式
├── world               // 服务器主世界地图
├── world_nether        // 服务器下界地图
└── world_the_end       // 服务器末路之地地图
```

## 常用插件及指令使用

1. 重设世界出生点到精确位置

    ```
    /gamerule spawnRadius 0  
    /setworldspawn x y z
    ```

2. Paper开启粘性活塞复制特性: 

    ```
    allow_piston_duplication=true
    ```

3. Linux类型系统远程连接命令

    ```
    ssh -NfR 8010:localhost:22 joker@jokerhub.cn
    ```

4. 使用 WorldEdit + WorldGuard 保护领域

- 清空玩家自已的所有物品: 

    ```
    /clear <player name>
    ```
- 获取选择区域的木斧:

    ```
    //wand
    ```
- 选中刚才获得的木斧，选择立方体区域对角线和一个顶点, 点击左键
- 选择立方体区域对角线和另一个顶点, 点击左键
- 扩展选中的区域最底部从基岩一直到天空最高处的立方体区域： 
    ```
    //expand vert
    ```
- 命名刚才选中的区域，这样就创建了一个区域: 
    ```
    /rg create <region name>
    ```
- 为区域设置标记指定区域内允许什么，不允许什么，可以点击选择是否允许:
    ```
    /rg flags <region name>
    ```
- 为区域添加成员: 
    ```
    /rg addmember <region name> <user or user group name>
    ```
- 为区域添加所有人: 
    ```
    /rg addowner <region name> <user name>
    ```
- 查看区域信息: 
    ```
    /rg info <region name>
    ```
- 设置子区域: 
    ```
    /rg setparent <child region name> <parent region name>
    ```
- 区域可以嵌套
- 可以跨存档导出导入区域：
    - 先选中区载后，使用 `//copy` 保存到剪贴板中
    - 再使用命令：`/schem save <filename>`，把区域保存到磁盘上
    - 其它存档载入后，使用命令: `/schem load <filename>` 把磁盘上的备份信息导入内存剪贴板中
    - 使用命令： `//paste` 相对玩家现在的位置，复制区域到地图中

5. 使用Residence进行领地保护: [Residence主页](https://www.zrips.net/residence/)

6. 查看指定日期记录服务器的玩家

    ```bash
    $ zcat 2021-07-31-1.log.gz | grep logged | cut -d ' ' -f 4 | cut -d '[' -f 1 | sort | uniq
    ```

7. 出现ViaVersion插件报错日志，是由于插件做了网络限流

    ```bash 
    lost connection: You are sending too many packets, :(
    ```

    解决办法: 修改ViaVersion插件的配置文件`config.yml`: 
    ```
    max-pps: -1
    tracking-period: -1
    ```

8. 服务器维护禁止使用 `rm -rf` 命令删除文件， 发生误删时无法恢复，风险很高，已经有过两次惨痛教训

9. 防止X-Ray探测透视矿，开启PaperMC服务器内置Anti-XRay能力：

```
# config/paper-world-defaults.yml
anti-xray:
  enabled: true       # 开启反透视功能
  engine-mode: 2      # 强烈推荐
  max-block-height: 64
  update-radius: 2
  lava-obscures: true # 开启岩浆防透视
  use-permission: false
```